@*
===============================================================================
Projet                         DRD.Web
Fichier                        Edit.cshtml
Type                           Razor View (MVC)
Classe                         Razor View (MVC)
Emplacement                    Views/GrpSystemTables/CdSetViews
Entités concernées             CdSetEditVM, EntityMetadataDto
Créé le                        2025-12-08

Description
    Vue d’édition d’un CdSet. Les clés (TypeCode + Code) sont affichées en
    lecture seule. Les champs bilingues et l’état actif/inactif sont modifiables.
    Inclut l’affichage des métadonnées système.

Fonctionnalité
    - Modification DescriptionFr, DescriptionEn, IsActive
    - Gestion ReturnUrl
    - Bouton Métadonnées DRD
    - Validation MVC + Toastr
    - Inputs readonly pour les clés
    - Champs hidden pour la clé composite (POST sécurisé)

Modifications
    2025-12-12   DRD v10 : Correction clé composite POST (TypeCode + Code)
    2025-12-12   DRD v10 : Bandeau bleu (Save / Back / Metadata)
    2025-12-09   Correction DRD v10 complète.
===============================================================================
*@

@model DRD.Web.Models.GrpSystemTables.CdSetVM.CdSetEditVM

@using static DRD.Resources.Common.Common
@using static DRD.Resources.LabelNames.CdSetLN
@using static DRD.Resources.Buttons.Buttons
@using static DRD.Resources.Popups.Popups
@using static DRD.Resources.EntityTitles.CdSetTitle

@using DRD.Application.Popup.Models

@{
    ViewData["Title"] = string.Format(CdSet_Edit_Title, Model.TypeCode, Model.Code);
    var returnUrl = Model.ReturnUrl ?? Url.Action("Index", "CdSet");
    var metadata = ViewData["Metadata"] as EntityMetadataDto;
}

@* ============================================================================
   ==== BANDEAU BLEU — EDIT ====
   ============================================================================ *@
<div class="d-flex justify-content-between align-items-center mb-4 p-3"
     style="background-color:#0d6efd; color:white; border-radius:8px;">

    <h2 class="m-0 fw-bold">@ViewData["Title"]</h2>

    <div class="d-flex gap-3">

        @* SAVE *@
        <button type="submit" form="editForm"
                class="btn btn-success btn-circle btn-3d"
                title="@Button_Save">
            <i class="fas fa-check"></i>
        </button>

        @* BACK *@
        @await Html.PartialAsync(
        "_ReturnButton",
                new DRD.Web.Models.Shared.Navigation.ReturnButtonVM
                {
                    ReturnUrl = Model.ReturnUrl,
                    ControllerName = "CdSet"
                }
                )

        @* METADATA *@
        @if (metadata != null)
        {
            <button type="button"
                    class="btn btn-info btn-circle btn-3d"
                    data-bs-toggle="modal"
                    data-bs-target="#systemMetadataModal"
                    title="@Button_Metadata">
                <i class="fa-solid fa-circle-info"></i>
            </button>
        }

    </div>
</div>

<form id="editForm" asp-action="Edit" method="post">

    @Html.AntiForgeryToken()

    @* 🔒 CLÉS COMPOSITES — OBLIGATOIRES POUR LE POST *@
    <input type="hidden" asp-for="TypeCode" />
    <input type="hidden" asp-for="Code" />
    <input type="hidden" asp-for="ReturnUrl" />

    <div class="card shadow-sm p-4">

        <div class="row mb-3">
            <div class="col-md-6">
                <label class="form-label">@Field_TypeCode</label>
                <input class="form-control input-3d"
                       value="@Model.TypeCode"
                       readonly />
            </div>

            <div class="col-md-6">
                <label class="form-label">@Field_Code</label>
                <input class="form-control input-3d"
                       value="@Model.Code"
                       readonly />
            </div>
        </div>

        <div class="mb-3">
            <label asp-for="DescriptionFr" class="form-label"></label>
            <input asp-for="DescriptionFr" class="form-control input-3d" />
            <span asp-validation-for="DescriptionFr" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="DescriptionEn" class="form-label"></label>
            <input asp-for="DescriptionEn" class="form-control input-3d" />
            <span asp-validation-for="DescriptionEn" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label class="form-label d-block">@IsActive</label>

            <div class="form-check form-switch">
                <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                <label class="form-check-label">
                    @(Model.IsActive? TextActive : TextInactive)
                </label>
            </div>
        </div>

    </div>
</form>

@if (metadata != null)
{
    <partial name="~/Views/Shared/Partials/_SystemMetadataPartial.cshtml"
             model="metadata" />
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
