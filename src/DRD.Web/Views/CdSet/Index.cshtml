@*
===============================================================================
Projet                        	DRD.Web
Fichier                       	Index.cshtml
Type                          	Vue Razor (MVC)
Classe                        	CdSet – Index View
Emplacement                   	Views/GrpSystemTables/CdSet
Entités concernées            	CdSetIndexVM, CdSetRowVM
Créé le                       	2025-12-07

Description
    Vue Index DRD v10 du module CdSet. Affiche les familles de code ainsi que
    leurs valeurs dans un tableau DataTables bilingue avec actions standardisées.
    Le style visuel respecte l’apparence “image 2” : bandeau bleu supérieur,
    filtres dans une card blanche, fond gris global.

Fonctionnalité
    - Bandeau bleu DRD v10 avec boutons Ajouter et Accueil (style rond 3D).
    - Card blanche contenant le filtre Famille.
    - Tableau DataTables bilingue (tri, pagination, recherche intégrée).
    - Formulaires Delete et Deactivate invisibles (compatibles avec modales).
    - Icônes Actif/Inactif en FontAwesome.
    - Aucun highlight post-édition (choix #2).
    - Aucun champ DescriptionAnglaise.

Modifications
    2025-12-12	Refonte visuelle complète (style image 2 + filtres card + DT v9).
===============================================================================
*@

@model DRD.Web.Models.GrpSystemTables.CdSetVM.CdSetIndexVM
@using DRD.Web.Models.Shared

@using static DRD.Resources.Buttons.Buttons
@using static DRD.Resources.Common.Common
@using static DRD.Resources.LabelNames.CdSetLN
@using static DRD.Resources.EntityTitles.CdSetTitle
@using static DRD.Resources.MessagesMetier.CdSet.CdSetMM
@using static DRD.Resources.Popups.Popups

@{
    ViewData["Title"] = Field_TypeCode_List_Title;
}

@section Styles {
    <style>
        .filter-row .form-label {
            font-weight: 600;
        }
    </style>
}

<!-- ======================= HEADER BLEU ======================= -->
<div class="card shadow-sm mb-4" style="border: none; background: transparent;">

    <div class="card-header text-white d-flex justify-content-between align-items-center"
         style="background-color:#0d6efd; border-top-left-radius:10px; border-top-right-radius:10px;">

        <h2 class="mb-0 text-white">@ViewData["Title"]</h2>

        <div class="d-flex gap-2">

            <!-- Bouton Ajouter -->
            <a asp-controller="CdSet"
               asp-action="Create"
               asp-route-returnUrl="@Model.CurrentUrl"
               class="btn btn-success btn-3d rounded-circle"
               title="@Button_Add"
               style="width:42px; height:42px; display:flex; align-items:center; justify-content:center;">
                <i class="fa-solid fa-plus"></i>
            </a>

            <!-- Bouton Accueil -->
            <a asp-controller="Home"
               asp-action="Index"
               class="btn btn-secondary btn-3d rounded-circle"
               title="@Button_Home"
               style="width:42px; height:42px; display:flex; align-items:center; justify-content:center;">
                <i class="fa-solid fa-house"></i>
            </a>

        </div>
    </div>

    <div style="height:6px; background:white; border-bottom-left-radius:10px; border-bottom-right-radius:10px;"></div>
</div>


<!-- ======================= CARD FILTRES ======================= -->
<div class="card shadow-sm mb-4" style="border-radius:10px;">
    <div class="card-body">

        <div class="row align-items-center filter-row g-3">

            <!-- LIBELLÉ -->
            <div class="col-md-3 d-flex align-items-center">
                <label for="typeCodeFilter"
                       class="form-label mb-0 fw-semibold me-3">
                    @Common_Select
                </label>
            </div>

            <!-- SELECT -->
            <div class="col-md-4">
                <select id="typeCodeFilter" class="form-select">
                    <option value="">@Select_All</option>

                    @foreach (var type in Model.AvailableTypeCodes)
                    {
                        var IsSelected = Model.SelectedTypeCode == type ? "selected" : "";
                        <option value="@type" selected="@IsSelected">@type</option>
                    }
                </select>
            </div>

        </div>

    </div>
</div>


<!-- ======================= TABLEAU ======================= -->
<div class="table-responsive mt-3">
    <table class="table table-striped table-hover datatable-bilingual"
           id="cdSetTable"
           style="width: 100%;">

        <thead>
            <tr>
                <th data-priority="3">@Field_TypeCode</th>
                <th data-priority="2">@Field_Code</th>
                <th data-priority="5">@Field_Description</th>
                <th class="text-center" data-priority="4">@IsActive</th>
                <th class="text-center" style="white-space: nowrap;">@Actions</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var row in Model.CdSets)
            {
                <tr>

                    <td>@row.TypeCode</td>
                    <td>@row.Code</td>
                    <td>@row.DescriptionLocalized</td>

                    <!-- ACTIF -->
                    <td class="text-center align-middle">
                        @if (row.IsActive)
                        {
                            <span class="text-success"><i class="fas fa-check-circle"></i></span>
                        }
                        else
                        {
                            <span class="text-danger"><i class="fas fa-times-circle"></i></span>
                        }
                    </td>

                    <!-- ACTIONS -->
                    <td class="text-center align-middle" style="white-space: nowrap;">

                        @await Html.PartialAsync(
                        "_EntityActionButtons",
                         new EntityActionButtonsVM(
                             controllerName: "CdSet",
                             entityId: $"{row.TypeCode}|{row.Code}",
                             entityName: CdSet_EntityName,
                             entityIdentifier: row.DescriptionLocalized,
                             deactivateMessageTemplate: Confirm_Deactivate_Message_Entity,
                             deleteMessageTemplate: Confirm_Delete_Message_Entity
                             )
                             {
                                 ReturnUrl = Model.CurrentUrl,
                                 ShowDeactivate = row.IsActive
                             }
                             )

                    </td>
                </tr>

            <!-- FORMULAIRES INVISIBLES (hors <td>) -->
            <form id="deleteForm-@row.TypeCode-@row.Code"
                  asp-controller="CdSet"
                  asp-action="DeleteConfirmed"
                  asp-route-id="@row.TypeCode"
                  asp-route-key2="@row.Code"
                  method="post"
                  class="d-none">
                @Html.AntiForgeryToken()
            </form>

            <form id="deactivateForm-@row.TypeCode-@row.Code"
                  asp-controller="CdSet"
                  asp-action="DeactivateConfirmed"
                  asp-route-id="@row.TypeCode"
                  asp-route-key2="@row.Code"
                  method="post"
                  class="d-none">
                @Html.AntiForgeryToken()
            </form>
        }
        </tbody>

    </table>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            // Filtre Famille
            document.getElementById("typeCodeFilter")
                ?.addEventListener("change", function () {
                    const selected = this.value;
                    const url = new URL(window.location.href);
                    url.searchParams.set("typeCode", selected);
                    window.location.href = url.toString();
                });

        });
    </script>

}
