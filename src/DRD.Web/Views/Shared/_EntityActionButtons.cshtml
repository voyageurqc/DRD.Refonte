@*
===============================================================================
Projet                         DRD.Web
Fichier                        _EntityActionButtons.cshtml
Type                           Vue partielle (MVC)
Classe                         _EntityActionButtons (Partial View)
Emplacement                    Views/Shared
Entités concernées             Générique (toutes les entités via EntityActionButtonsVM)
Créé le                        2025-10-24

Description
    Vue partielle responsable de générer un groupe standardisé de boutons
    d’action (Détails, Modifier, Désactiver, Supprimer).

Fonctionnalité
    - Boutons d’action 3D DRD standard.
    - Support des clés composites TypeCode|Code.
    - Suppression via callback JS universel.
    - Désactivation via soumission directe de formulaire (DRD rule).

Modifications
    2025-12-14    Correction DRD v10 : désactivation via submitFormById explicite
===============================================================================
*@

@using static DRD.Resources.Common.Common
@using static DRD.Resources.Buttons.Buttons
@using static DRD.Resources.Popups.Popups

@model DRD.Web.Models.Shared.EntityActionButtonsVM

@if (Model != null)
{
    #region Préparation des clés

    string[] keys = (Model.EntityId ?? string.Empty)
        .Split('|', StringSplitOptions.RemoveEmptyEntries);

    var routeValues = new Dictionary<string, string>();
    if (keys.Length >= 1) routeValues["id"] = keys[0];
    if (keys.Length >= 2) routeValues["key2"] = keys[1];

    string safeEntityId = (Model.EntityId ?? string.Empty).Replace("|", "-");

    #endregion

    <div class="btn-group" role="group">

        @* DETAILS *@
        @if (Model.ShowDetails)
        {
            <a asp-controller="@Model.ControllerName"
               asp-action="Details"
               asp-all-route-data="routeValues"
               asp-route-returnUrl="@Model.ReturnUrl"
               class="btn btn-primary btn-sm btn-3d"
               title="@Button_View">
                <i class="fas fa-eye"></i>
            </a>
        }

        @* EDIT *@
        @if (Model.ShowEdit)
        {
            <a asp-controller="@Model.ControllerName"
               asp-action="Edit"
               asp-all-route-data="routeValues"
               asp-route-returnUrl="@Model.ReturnUrl"
               class="btn btn-info btn-sm btn-3d"
               title="@Button_Edit">
                <i class="fas fa-pen-to-square"></i>
            </a>
        }

        @* DEACTIVATE — FORME DRD STABLE *@
        @if (Model.ShowDeactivate)
        {
            <button type="button"
                    class="btn btn-warning btn-sm btn-3d"
                    title="@Button_Deactivate"
                    data-bs-toggle="modal"
                    data-bs-target="#confirmationModal"
                    data-modal-title="@Model.DeactivateTitle"
                    data-modal-message="@Model.DeactivateMessage"
                    data-modal-confirm-text="@Button_Confirm"
                    data-modal-success-callback="submitFormById"
                    data-item-id="deactivateForm-@safeEntityId">
                <i class="fa fa-power-off"></i>
            </button>
        }

        @* DELETE — CALLBACK UNIVERSEL *@
        @if (Model.ShowDelete)
        {
            <button type="button"
                    class="btn btn-danger btn-sm btn-3d"
                    title="@Button_Delete"
                    data-bs-toggle="modal"
                    data-bs-target="#confirmationModal"
                    data-modal-title="@Model.DeleteTitle"
                    data-modal-message="@Model.DeleteMessage"
                    data-modal-confirm-text="@Button_Confirm"
                    data-modal-success-callback="submitFormById"
                    data-item-id="deleteForm-@safeEntityId">
                <i class="fas fa-trash"></i>
            </button>
        }

    </div>
}
