@* ============================================================================
Projet:      DRD.Web
Fichier:     _Layout.cshtml
Type:        Layout (Razor)
Classe:      Layout Global
Emplacement: Views/Shared
Entité(s):   ApplicationUser
Créé le:     2025-12-06

Description
    Mise en page principale DRD v10 : entête fixe, sidebar bilingue (_NavLayout),
    contenu flexible et footer sticky DRD avec logo, © FontAwesome, ressources 
    bilingues et numéro de version dynamique.

Fonctionnalité
    - Header fixe avec gestion culture, profil usager, heure de connexion.
    - Sidebar bilingue rendue via _NavLayout.
    - Zone de contenu responsive.
    - Footer permanent DRD avec texte bilingue, logo, version dynamique.
    - Ressources .resx pour tout le texte visible.

Modifications
    2025-12-06  Ajout footer DRD sticky avec logo, ©, version dynamique.
    2025-12-06  Intégration bilingue ressources Footer_*.
    2025-12-05  Nettoyage flex + correction disparition footer.
    2025-12-04  Version DRD v10.
=============================================================================== *@

@using System.Globalization
@using System.Reflection
@using Microsoft.AspNetCore.Hosting
@using DRD.Infrastructure.Identity
@using Microsoft.AspNetCore.Identity

@using static DRD.Resources.Common.Common
@using static DRD.Resources.Menu.Menu
@using static DRD.Resources.Buttons
@using static DRD.Resources.NavBar
@using static DRD.Resources.SideBar

@model object

@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager
@inject IWebHostEnvironment Env
@{
    // Récupère la version de l’assembly en cours (DRD.Web)
    var assembly = Assembly.GetExecutingAssembly();
    var rawVersion = assembly.GetName().Version;

    // formate version : 10.0.1.0 → "10.0.1"
    string version = rawVersion != null
        ? $"{rawVersion.Major}.{rawVersion.Minor}.{rawVersion.Build}"
        : "1.0.0";
}



<!DOCTYPE html>
<html lang="@CultureInfo.CurrentCulture.Name">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@AppName</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    @RenderSection("Styles", required: false)
</head>

<body class="@ViewData["BodyClass"]">

    @{
        bool userIsAuthenticated = SignInManager.IsSignedIn(User);
        string? fullName = null;
        DateTime? connectionTime = null;

        if (userIsAuthenticated)
        {
            var currentUser = await UserManager.GetUserAsync(User);
            fullName = $"{currentUser?.FirstName} {currentUser?.LastName}".Trim();
            connectionTime = DateTime.Now;
        }
    }

    <header class="app-header-fixed shadow d-flex justify-content-between align-items-center px-3">
        <div class="d-flex align-items-center">
            <img src="~/images/UNI/unilogo.png" alt="Logo DRD" style="height: 40px;" />
            <span class="ms-3 fs-5 fw-bold text-white d-none d-md-block">@AppName</span>
        </div>

        <div class="d-flex align-items-center gap-4">

            @if (userIsAuthenticated)
            {
                <div class="d-flex align-items-center gap-3 text-white">
                    <i class="fa-solid fa-user-check fa-lg"></i>
                    <div class="small text-end">
                        <div class="fw-bold">@fullName</div>
                        <a asp-controller="User" asp-action="Manage" class="text-white-50">@Manage_Account</a>
                    </div>
                    <div class="vr"></div>
                    <div class="small text-end">
                        <div>@Date_Connected</div>
                        <strong>@connectionTime?.ToString("dd MMMM, HH:mm")</strong>
                    </div>
                </div>
            }

            <form asp-controller="Localization" asp-action="ToggleLanguage" method="post" class="m-0">
                <button type="submit" class="btn btn-info text-dark btn-sm btn-3d" title="@Button_Toggle_Culture">
                    🌍 @(CultureInfo.CurrentCulture.TwoLetterISOLanguageName.ToUpper() == "FR" ? "English" : "Français")
                </button>
            </form>

            @if (userIsAuthenticated)
            {
                <form asp-controller="Account" asp-action="Logout" method="post" class="m-0">
                    <button type="submit" class="btn btn-3d btn-danger" title="@Button_Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </form>
            }
            else
            {
                <a asp-controller="Account" asp-action="Login" class="btn btn-3d btn-success" title="@Button_Login">
                    <i class="fas fa-sign-in-alt"></i>
                </a>
            }

        </div>
    </header>

    <div class="app-body-wrapper">

        @if (userIsAuthenticated)
        {
            <aside class="app-sidebar">
                @await Html.PartialAsync("_NavLayout")
            </aside>
        }

        <div class="main-content-area d-flex flex-column flex-grow-1">

            <main class="p-4" style="flex: 1 0 auto";>
                @RenderBody()
            </main>

            @* === FOOTER DRD v10 — Logo Mini + © + Texte Bilingue + Version Dynamique === *@
            <footer class="app-footer-fixed d-flex align-items-center justify-content-center shadow text-white py-2 px-3">

                <img src="~/images/UNI/unilogo.png" alt="Logo DRD" class="footer-logo me-2" />

                <i class="fa-regular fa-copyright me-1"></i>

                <span class="fw-bold">
                    <span class="fw-bold">
                        @DateTime.Now.Year — @Footer_Text — @Footer_Version @($"v{version}")
                    </span>
                </span>

            </footer>

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <partial name="_Toastr" />

    @RenderSection("Scripts", required: false)

</body>
</html>
